# SmartResearch ç§»æ¤ä»£ç æ£€æŸ¥è®¡åˆ’ä¹¦

## ğŸ“‹ æ¦‚å†µåˆ†æ

åŸºäºå¯¹ä¸‰ä»½è®¡åˆ’ä¹¦å†…å®¹çš„åˆ†æï¼Œä»¥åŠSmartResearch (Rubyç‰ˆæœ¬) å’ŒSmartResearch-py (Pythonç‰ˆæœ¬) çš„å¯¹æ¯”ï¼Œåˆ¶å®šé€æ–‡ä»¶çš„ç§»æ¤ä»£ç æ£€æŸ¥è®¡åˆ’ã€‚

### å½“å‰ç§»æ¤çŠ¶æ€æ€»è§ˆ

#### âœ… **å·²å®Œæˆç§»æ¤** (100%å®Œæˆ)
- **Modelså±‚**: 11ä¸ªæ¨¡å‹æ–‡ä»¶å…¨éƒ¨å®Œæˆ
- **åŸºç¡€è®¾æ–½**: æ•°æ®åº“è¿æ¥ã€ORMé…ç½®
- **Agentsæ¡†æ¶**: Coze SDKé›†æˆæ¡†æ¶æ­å»ºå®Œæˆ

#### ğŸ”„ **éƒ¨åˆ†å®Œæˆ** (æ¡†æ¶æ­å»ºé˜¶æ®µ)
- **Agentsç³»ç»Ÿ**: å·¥ä½œæµæ¡†æ¶å·²æ­å»ºï¼Œå…·ä½“å®ç°å¾…å®Œå–„
- **å·¥å…·ç³»ç»Ÿ**: ç»“æ„å·²å»ºç«‹ï¼Œå…·ä½“å·¥å…·å®ç°å¾…è¡¥å……

#### âŒ **æœªå¼€å§‹ç§»æ¤**
- **Workers**: 18ä¸ªAI Workerséœ€è¦å®Œæ•´è¿ç§»
- **Tools**: 10ä¸ªå…·ä½“å·¥å…·éœ€è¦å®ç°
- **Templates**: 15ä¸ªæ¨¡æ¿éœ€è¦è½¬æ¢ä¸ºCozeé…ç½®

## ğŸ“ æ–‡ä»¶çº§ç§»æ¤æ£€æŸ¥è®¡åˆ’

### ç¬¬ä¸€å±‚çº§ï¼šModelså±‚ (âœ… å·²å®Œæˆ - éœ€éªŒè¯)

#### 1.1 æ ¸å¿ƒæ¨¡å‹æ–‡ä»¶å¯¹æ¯”æ£€æŸ¥

| RubyåŸæ–‡ä»¶ | Pythonè¿ç§»æ–‡ä»¶ | æ£€æŸ¥çŠ¶æ€ | éªŒè¯é‡ç‚¹ |
|-----------|---------------|---------|---------|
| `lib/models/tag.rb` | `models/tag.py` | âœ… å®Œæˆ | å­—æ®µæ˜ å°„ã€å…³è”å…³ç³» |
| `lib/models/short_memory.rb` | `models/short_memory.py` | âœ… å®Œæˆ | å†…å­˜ç¼“å­˜é€»è¾‘ |
| `lib/models/source_document.rb` | `models/source_document.py` | âœ… å®Œæˆ | æ–‡æ¡£å­—æ®µã€ç´¢å¼• |
| `lib/models/research_topic.rb` | `models/research_topic.py` | âœ… å®Œæˆ | ä¸»é¢˜ç®¡ç†é€»è¾‘ |
| `lib/models/source_section.rb` | `models/source_section.py` | âœ… å®Œæˆ | æ®µè½å¤„ç†ã€å…³è” |
| `lib/models/tag_link.rb` | `models/tag_link.py` | âœ… å®Œæˆ | æ ‡ç­¾é“¾æ¥å…³ç³» |

#### 1.2 å…³è”è¡¨æ–‡ä»¶æ£€æŸ¥

| RubyåŸæ–‡ä»¶ | Pythonè¿ç§»æ–‡ä»¶ | æ£€æŸ¥çŠ¶æ€ | éªŒè¯é‡ç‚¹ |
|-----------|---------------|---------|---------|
| `lib/models/research_topic_section.rb` | `models/associations.py` | âœ… å®Œæˆ | å¤šå¯¹å¤šå…³è”è¡¨ |
| `lib/models/research_topic_tag.rb` | `models/associations.py` | âœ… å®Œæˆ | å¤šå¯¹å¤šå…³è”è¡¨ |
| `lib/models/section_tag.rb` | `models/associations.py` | âœ… å®Œæˆ | å¤šå¯¹å¤šå…³è”è¡¨ |

#### 1.3 é«˜çº§åŠŸèƒ½æ¨¡å‹æ£€æŸ¥

| RubyåŸæ–‡ä»¶ | Pythonè¿ç§»æ–‡ä»¶ | æ£€æŸ¥çŠ¶æ€ | éªŒè¯é‡ç‚¹ |
|-----------|---------------|---------|---------|
| `lib/models/embedding.rb` | `models/embedding.py` | âœ… å®Œæˆ | ğŸ” **å‘é‡æœç´¢åŠŸèƒ½** |
| `lib/models/query_processor.rb` | `models/query_processor.py` | âœ… å®Œæˆ | ğŸ” **æŸ¥è¯¢å¤„ç†é€»è¾‘** |

**æ£€æŸ¥è¦ç‚¹:**
- [ ] å‘é‡æœç´¢çš„`cosine_distance`å®ç°æ˜¯å¦æ­£ç¡®
- [ ] `search_by_vector_with_tag_boost`åŠŸèƒ½æ˜¯å¦å®Œæ•´
- [ ] å¤šè¯­è¨€æ ‡ç­¾å¤„ç†é€»è¾‘æ˜¯å¦ä¿ç•™
- [ ] AIå¼•æ“æ¥å£è°ƒç”¨æ˜¯å¦é€‚é…

### ç¬¬äºŒå±‚çº§ï¼šWorkerså±‚ (âŒ æœªå¼€å§‹ - éœ€å®Œæ•´è¿ç§»)

#### 2.1 æ ¸å¿ƒAI Workerè¿ç§»è®¡åˆ’

| ä¼˜å…ˆçº§ | RubyåŸæ–‡ä»¶ | è®¡åˆ’Pythonæ–‡ä»¶ | å¤æ‚åº¦ | è¿ç§»ç­–ç•¥ |
|-------|-----------|---------------|--------|---------|
| ğŸ”´ **P1** | `agents/workers/get_tags.rb` | `agents/bots/get_tags.py` | ä½ | Coze Boté…ç½® |
| ğŸ”´ **P1** | `agents/workers/get_topic.rb` | `agents/bots/get_topic.py` | ä½ | Coze Boté…ç½® |
| ğŸ”´ **P1** | `agents/workers/summary.rb` | `agents/bots/summary.py` | ä½ | Coze Boté…ç½® |
| ğŸŸ¡ **P2** | `agents/workers/analyze_search_scope.rb` | `agents/bots/analyze_search_scope.py` | ä¸­ | Coze Bot + å·¥å…·è°ƒç”¨ |
| ğŸŸ¡ **P2** | `agents/workers/generate_search_plan.rb` | `agents/bots/generate_search_plan.py` | ä¸­ | Coze Bot + å·¥å…·è°ƒç”¨ |
| ğŸŸ¡ **P2** | `agents/workers/pre_search.rb` | `agents/bots/pre_search.py` | ä¸­ | Coze Bot + å·¥å…·è°ƒç”¨ |

#### 2.2 ä¸“ä¸šåŠŸèƒ½Workerè¿ç§»

| ä¼˜å…ˆçº§ | RubyåŸæ–‡ä»¶ | è®¡åˆ’Pythonæ–‡ä»¶ | å¤æ‚åº¦ | è¿ç§»ç­–ç•¥ |
|-------|-----------|---------------|--------|---------|
| ğŸŸ¢ **P3** | `agents/workers/chapter_writer.rb` | `agents/bots/chapter_writer.py` | é«˜ | Coze Bot + æ¨¡æ¿ |
| ğŸŸ¢ **P3** | `agents/workers/download_page_worker.rb` | `agents/bots/download_page_worker.py` | ä¸­ | Coze Bot + HTTPå·¥å…· |
| ğŸŸ¢ **P3** | `agents/workers/get_embedding.rb` | `agents/bots/get_embedding.py` | é«˜ | å‘é‡è®¡ç®—é›†æˆ |

**æ¯ä¸ªWorkeræ£€æŸ¥è¦ç‚¹:**
- [ ] SmartPromptè°ƒç”¨é€»è¾‘è½¬æ¢ä¸ºCoze SDKè°ƒç”¨
- [ ] å‚æ•°å¤„ç†å’Œè¿”å›æ ¼å¼æ˜¯å¦ä¸€è‡´
- [ ] é”™è¯¯å¤„ç†æœºåˆ¶æ˜¯å¦å®Œæ•´
- [ ] æ¨¡æ¿ä½¿ç”¨æ˜¯å¦æ­£ç¡®è½¬æ¢

### ç¬¬ä¸‰å±‚çº§ï¼šToolså±‚ (âŒ æœªå¼€å§‹ - éœ€å®Œæ•´å®ç°)

#### 3.1 æ•°æ®åº“æ“ä½œå·¥å…·è¿ç§» (ä¼˜åŠ¿ï¼šæœ‰ModelsåŸºç¡€)

| ä¼˜å…ˆçº§ | RubyåŸæ–‡ä»¶ | è®¡åˆ’Pythonæ–‡ä»¶ | å¤æ‚åº¦ | åˆ©ç”¨ç°æœ‰åŸºç¡€ |
|-------|-----------|---------------|--------|-------------|
| ğŸ”´ **P1** | `agents/tools/create_research_topic.rb` | `agents/tools/create_research_topic.py` | **ä½** | âœ… ResearchTopicæ¨¡å‹ |
| ğŸ”´ **P1** | `agents/tools/get_research_topics.rb` | `agents/tools/get_research_topics.py` | **ä½** | âœ… ResearchTopicæ¨¡å‹ |
| ğŸ”´ **P1** | `agents/tools/query_db.rb` | `agents/tools/query_db.py` | **ä½** | âœ… QueryProcessorç±» |
| ğŸŸ¡ **P2** | `agents/tools/create_or_update_source_document_and_section.rb` | `agents/tools/document_manager.py` | ä¸­ | âœ… SourceDocument + SourceSection |

#### 3.2 å¤–éƒ¨æœåŠ¡å·¥å…·è¿ç§»

| ä¼˜å…ˆçº§ | RubyåŸæ–‡ä»¶ | è®¡åˆ’Pythonæ–‡ä»¶ | å¤æ‚åº¦ | è¿ç§»ç­–ç•¥ |
|-------|-----------|---------------|--------|---------|
| ğŸŸ¡ **P2** | `agents/tools/smart_search.rb` | `agents/tools/smart_search.py` | é«˜ | æœç´¢API + æ•°æ®å¤„ç† |
| ğŸŸ¡ **P2** | `agents/tools/meta_scrape.rb` | `agents/tools/meta_scrape.py` | ä¸­ | ç½‘é¡µæŠ“å– |
| ğŸŸ¢ **P3** | `agents/tools/get_weather.rb` | `agents/tools/get_weather.py` | ä½ | APIè°ƒç”¨ |
| ğŸŸ¢ **P3** | `agents/tools/get_code.rb` | `agents/tools/get_code.py` | ä½ | ä»£ç ç”Ÿæˆ |

**æ¯ä¸ªToolæ£€æŸ¥è¦ç‚¹:**
- [ ] ä¸ç°æœ‰SQLAlchemyæ¨¡å‹çš„é›†æˆæ˜¯å¦æ­£ç¡®
- [ ] Cozeæœ¬åœ°æ’ä»¶æ³¨å†Œæ˜¯å¦æ­£ç¡®
- [ ] å·¥å…·å‚æ•°éªŒè¯å’Œé”™è¯¯å¤„ç†
- [ ] è¿”å›æ•°æ®æ ¼å¼æ ‡å‡†åŒ–

### ç¬¬å››å±‚çº§ï¼šAgentså±‚ (ğŸ”„ æ¡†æ¶å·²æ­å»º - éœ€å®ç°å…·ä½“é€»è¾‘)

#### 4.1 æ ¸å¿ƒAgentè¿ç§»éªŒè¯

| ä¼˜å…ˆçº§ | RubyåŸæ–‡ä»¶ | Pythonæ¡†æ¶æ–‡ä»¶ | çŠ¶æ€ | æ£€æŸ¥é‡ç‚¹ |
|-------|-----------|----------------|------|---------|
| ğŸ”´ **P1** | `agents/smart_search.rb` | `agents/workflows/smart_search.py` | ğŸ”„ æ¡†æ¶å®Œæˆ | å·¥ä½œæµé€»è¾‘å®ç° |
| ğŸ”´ **P1** | `agents/smart_kb.rb` | `agents/workflows/smart_kb.py` | ğŸ”„ æ¡†æ¶å®Œæˆ | çŸ¥è¯†åº“ç®¡ç†é€»è¾‘ |
| ğŸ”´ **P1** | `agents/smart_writer.rb` | `agents/workflows/smart_writer.py` | ğŸ”„ æ¡†æ¶å®Œæˆ | å†™ä½œæµç¨‹å®ç° |

#### 4.2 Agentå®ç°æ£€æŸ¥è¦ç‚¹

**smart_search.rb â†’ smart_search.py**
- [ ] `pre_search` workerè°ƒç”¨é€»è¾‘
- [ ] `smart_search` workerè°ƒç”¨é€»è¾‘  
- [ ] `summary` workerè°ƒç”¨é€»è¾‘
- [ ] å·¥å…·è°ƒç”¨é“¾(`call_tools`)å¤„ç†
- [ ] å†å²å¯¹è¯ç®¡ç†

**smart_kb.rb â†’ smart_kb.py**
- [ ] çŸ¥è¯†åº“æŸ¥è¯¢å’Œå¤„ç†æµç¨‹
- [ ] å†…å®¹åˆ†å—å’Œå‘é‡åŒ–å¤„ç†
- [ ] ç›¸ä¼¼åº¦æœç´¢å’Œç»“æœæ’åº
- [ ] çŸ¥è¯†åº“æ›´æ–°å’Œç»´æŠ¤

**smart_writer.rb â†’ smart_writer.py** (469è¡Œï¼Œæœ€å¤æ‚)
- [ ] å¤§çº²ç”Ÿæˆé€»è¾‘
- [ ] ç« èŠ‚å†™ä½œæµç¨‹
- [ ] å†…å®¹ç»„ç»‡å’Œç»“æ„åŒ–
- [ ] æŸ¥è¯¢å¤„ç†å™¨é›†æˆ

### ç¬¬äº”å±‚çº§ï¼šæ¨¡æ¿ç³»ç»Ÿ (âŒ æœªå¼€å§‹)

#### 5.1 ERBæ¨¡æ¿è½¬æ¢æ£€æŸ¥

| Ruby ERBæ–‡ä»¶è·¯å¾„ | Cozeé…ç½®ä½ç½® | è½¬æ¢ç­–ç•¥ | ä¼˜å…ˆçº§ |
|-----------------|-------------|---------|--------|
| `agents/templates/*.erb` | Cozeå¹³å°Boté…ç½® | æ‰‹åŠ¨é…ç½®prompt | ğŸŸ¡ **P2** |

**æ¨¡æ¿è½¬æ¢æ£€æŸ¥è¦ç‚¹:**
- [ ] ERBè¯­æ³•(`<%= %>`) â†’ Cozeå˜é‡è¯­æ³•(`{{}}`)
- [ ] æ¡ä»¶é€»è¾‘ä¿æŒä¸€è‡´
- [ ] å¤šè¯­è¨€æ”¯æŒä¿ç•™
- [ ] å‚æ•°ä¼ é€’æ­£ç¡®æ€§

### ç¬¬å…­å±‚çº§ï¼šé…ç½®å’Œéƒ¨ç½² (ğŸ”„ éƒ¨åˆ†å®Œæˆ)

#### 6.1 é…ç½®æ–‡ä»¶æ£€æŸ¥

| é…ç½®ç±»å‹ | Rubyç‰ˆæœ¬ | Pythonç‰ˆæœ¬ | çŠ¶æ€ | æ£€æŸ¥è¦ç‚¹ |
|---------|---------|-------------|------|---------|
| æ•°æ®åº“é…ç½® | `config/database.yml` | `database.py` | âœ… å®Œæˆ | è¿æ¥æ± ã€äº‹åŠ¡å¤„ç† |
| ä¾èµ–ç®¡ç† | `Gemfile` | `requirements.txt` | âœ… å®Œæˆ | ç‰ˆæœ¬å…¼å®¹æ€§ |
| åº”ç”¨é…ç½® | `config/application.rb` | `config.ini` | ğŸ”„ éƒ¨åˆ† | ç¯å¢ƒå˜é‡ç®¡ç† |
| Cozeé…ç½® | æ—  | `agents/config.json` | ğŸ†• æ–°å¢ | APIå¯†é’¥ç®¡ç† |

## ğŸ¯ æ£€æŸ¥æ‰§è¡Œè®¡åˆ’

### ç¬¬1é˜¶æ®µï¼šModelså±‚éªŒè¯ (1å‘¨)
- [ ] è¿è¡Œç°æœ‰æµ‹è¯•å¥—ä»¶éªŒè¯Modelså±‚
- [ ] é‡ç‚¹éªŒè¯å‘é‡æœç´¢å’ŒæŸ¥è¯¢å¤„ç†åŠŸèƒ½
- [ ] ç¡®ä¿æ‰€æœ‰å…³è”å…³ç³»æ­£ç¡®å»ºç«‹

### ç¬¬2é˜¶æ®µï¼šToolså±‚å®ç° (2å‘¨)
- [ ] ä¼˜å…ˆå®ç°æ•°æ®åº“æ“ä½œå·¥å…·(åˆ©ç”¨Modelsä¼˜åŠ¿)
- [ ] é€ä¸ªå·¥å…·æµ‹è¯•å’ŒéªŒè¯
- [ ] å·¥å…·ä¸Coze SDKçš„é›†æˆæµ‹è¯•

### ç¬¬3é˜¶æ®µï¼šWorkerså±‚è¿ç§» (2-3å‘¨)
- [ ] æŒ‰ä¼˜å…ˆçº§å®ç°18ä¸ªAI Workers
- [ ] Coze Boté…ç½®å’Œæµ‹è¯•
- [ ] Workerå‚æ•°å’Œè¿”å›æ ¼å¼éªŒè¯

### ç¬¬4é˜¶æ®µï¼šAgentså±‚å®Œå–„ (2å‘¨)
- [ ] åŸºäºå·²å®ç°çš„Workerså’ŒToolså®Œå–„Agentsé€»è¾‘
- [ ] ç«¯åˆ°ç«¯å·¥ä½œæµæµ‹è¯•
- [ ] æ€§èƒ½å’Œç¨³å®šæ€§éªŒè¯

### ç¬¬5é˜¶æ®µï¼šæ¨¡æ¿å’Œéƒ¨ç½² (1å‘¨)
- [ ] æ¨¡æ¿è½¬æ¢å’ŒCozeå¹³å°é…ç½®
- [ ] å®Œæ•´ç³»ç»Ÿé›†æˆæµ‹è¯•
- [ ] éƒ¨ç½²å’Œæ–‡æ¡£å®Œå–„

## ğŸ“Š é£é™©è¯„ä¼°å’Œç¼“è§£ç­–ç•¥

### ğŸ”´ **é«˜é£é™©é¡¹**
1. **smart_writer.rbçš„å¤æ‚é€»è¾‘è¿ç§»**
   - ç¼“è§£ï¼šåˆ†é˜¶æ®µå®ç°ï¼Œå…ˆå®ç°åŸºæœ¬åŠŸèƒ½
   - åˆ©ç”¨ç°æœ‰QueryProcessorç®€åŒ–å¤„ç†

2. **å‘é‡æœç´¢æ€§èƒ½éªŒè¯**
   - ç¼“è§£ï¼šé‡ç‚¹æµ‹è¯•`search_by_vector_with_tag_boost`åŠŸèƒ½
   - ç¡®ä¿pgvectoré…ç½®æ­£ç¡®

### ğŸŸ¡ **ä¸­é£é™©é¡¹**
1. **Coze SDKé›†æˆçš„ç¨³å®šæ€§**
   - ç¼“è§£ï¼šå®ç°é”™è¯¯é‡è¯•æœºåˆ¶
   - å»ºç«‹æœ¬åœ°æµ‹è¯•ç¯å¢ƒ

2. **å¤šè¯­è¨€æ ‡ç­¾å¤„ç†çš„å‡†ç¡®æ€§**
   - ç¼“è§£ï¼šä¿ç•™åŸRubyé€»è¾‘ï¼Œé€æ­¥éªŒè¯

### ğŸŸ¢ **ä½é£é™©é¡¹** 
1. **æ•°æ®åº“æ“ä½œå·¥å…·** - å·²æœ‰ModelsåŸºç¡€ï¼Œé£é™©å¾ˆä½
2. **åŸºç¡€AI Workers** - Coze Boté…ç½®ç›¸å¯¹ç®€å•

## ğŸ“ˆ æˆåŠŸæŒ‡æ ‡

### åŠŸèƒ½å®Œæ•´æ€§æŒ‡æ ‡
- [ ] 18ä¸ªWorkers 100%åŠŸèƒ½å¯¹ç­‰
- [ ] 10ä¸ªTools 100%åŠŸèƒ½å®ç°  
- [ ] 3ä¸ªæ ¸å¿ƒAgentså®Œå…¨å¯ç”¨
- [ ] ç«¯åˆ°ç«¯å·¥ä½œæµæµ‹è¯•é€šè¿‡

### æ€§èƒ½æŒ‡æ ‡
- [ ] æŸ¥è¯¢å“åº”æ—¶é—´â‰¤Rubyç‰ˆæœ¬çš„120%
- [ ] å‘é‡æœç´¢ç²¾åº¦ä¿æŒä¸€è‡´
- [ ] AIè°ƒç”¨æˆåŠŸç‡â‰¥95%

### é›†æˆæŒ‡æ ‡
- [ ] Coze SDKè°ƒç”¨ç¨³å®šæ€§éªŒè¯
- [ ] æ•°æ®åº“æ“ä½œäº‹åŠ¡ä¸€è‡´æ€§
- [ ] é”™è¯¯å¤„ç†å’Œæ—¥å¿—å®Œæ•´æ€§

è¿™ä¸ªæ£€æŸ¥è®¡åˆ’åŸºäºå·²å®Œæˆçš„Modelså±‚ä¼˜åŠ¿ï¼Œé‡ç‚¹å…³æ³¨æœªå®Œæˆçš„Workersã€Toolsã€å’ŒAgentså±‚çš„å…·ä½“å®ç°ï¼Œç¡®ä¿ç§»æ¤å·¥ä½œæœ‰åºæ¨è¿›å¹¶æœ€ç»ˆå®ç°åŠŸèƒ½å®Œæ•´å¯¹ç­‰ã€‚